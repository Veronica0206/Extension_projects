---
title: "Estimating knots and Knot-knot Association of PBLSGMs in the framework of individual measurement occasions"
author: Jin Liu
output: rmarkdown::github_document
date: \today
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## OS, R version and OpenMx Version
```{r}
OpenMx::mxVersion()
```

## Require package would be used
```{r}
library(tidyr)
library(ggplot2)
```

## Read in dataset for analyses (wide-format data)
```{r}
dat <- read.csv(file = "example_data.csv")
```

## Summarize data
```{r}
summary(dat)
```

## Visualize data
```{r}
long_dat_T <- gather(dat[, c(1, 22:31), ], key = var.T, value = time, T1:T10)
long_dat_Y <- gather(dat[, c(1, 2:11), ], key = var.Y, value = measuresY, Y1:Y10)
long_dat_Y$outcome <- "Y"
long_dat_Z <- gather(dat[, c(1, 12:21), ], key = var.Z, value = measuresZ, Z1:Z10)
long_dat_Z$outcome <- "Z"
long_dat <- data.frame(id = rep(long_dat_T$id, 2),
                       time = rep(long_dat_T$time, 2),
                       measures = c(long_dat_Y$measuresY, long_dat_Z$measuresZ),
                       outcome = c(long_dat_Y$outcome, long_dat_Z$outcome))

ggplot(aes(x = time, y = measures), data = long_dat) +
  geom_line(aes(group = id), color = "lightgrey", linetype = "dotted", 
            data = long_dat[long_dat$outcome == "Y", ]) +
  geom_line(aes(group = id), color = "lightgrey", linetype = "dashed", 
            data = long_dat[long_dat$outcome == "Z", ]) +
  geom_point(aes(group = id), color = "darkgrey", shape = 0,
             data = long_dat[long_dat$outcome == "Y", ], size = 0.8) +
  geom_point(aes(group = id), color = "darkgrey", shape = 2,
             data = long_dat[long_dat$outcome == "Z", ], size = 0.8) +
  geom_smooth(aes(group = 1), size = 1.8, col = "lightblue", se = F, 
              data = long_dat[long_dat$outcome == "Y", ] ) + 
  geom_smooth(aes(group = 1), size = 1.8, col = "pink", se = F, 
              data = long_dat[long_dat$outcome == "Z", ] ) + 
  labs(title = "Parallel nonlinear Pattern with Individually Varying Measurement Time",
       x ="Time", y = "Measurement") + 
  theme(plot.title = element_text(hjust = 0.5))

```

## Parallel Bilinear Spline Growth Model with Unknown Random Knots
```{r, message = F}
source("PBLSGM_random.R")
out
```

## Parallel Bilinear Spline Growth Model with Unknown Fixed Knots
```{r, message = F}
source("PBLSGM_fixed.R")
out
```



